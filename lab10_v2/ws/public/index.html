<!DOCTYPE html>
<html>

<head>
  <title>WebSocket API</title>
  <meta charset="UTF-8">
  <link rel="stylesheet" href="css/styl.css" />
  <script src="js/jquery.min.js"></script>
  <script src="js/socket.io/socket.io.js"></script>
  <script src="js/skrypt.js"></script>
</head>

<body>
  <h1 id="title">WebSocket API</h1>
  <h3>Chats:</h3>
  <ul id="chats"></ul>
  <h3>Create your char:</h3>
  <input type="text" id="roomName">
  <button id="btn" onclick="createChat(document.getElementById('roomName').value, document.getElementById('chats'))">Create your chat</button>
  <h3>Write twit</h3>
  <div>chat:</div>
  <input type="text" id="chatName">
  <div>text:</div>
  <input type="text" id="twit">
  <button id="twitbutton" onclick="sendTwit(document.getElementById('twit').value, document.getElementById('chatName').value)">Send ></button>
  <h3>Twits</h3>
  <div id="twits"></div>
  <script>
    socket.on('loaded', chats => {
      const rooms = document.getElementById('chats')
      chats.forEach(chatname => {
        let li = document.createElement("li");
        li.innerText = chatname;
        li.id = chatname
        rooms.appendChild(li);

        let joinbutton = document.createElement("button");
        joinbutton.innerHTML = "Join";
        //joinbutton.onclick = function(){socket.emit("joinChat", chatname)}
        joinbutton.onclick = function(){
          li.removeChild(joinbutton)
          let leavebutton = document.createElement("button");
          leavebutton.innerHTML = "Leave";
          leavebutton.onclick = function(){
            li.removeChild(leavebutton)
            /*let joinbutton = document.createElement("button");
            joinbutton.innerHTML = "Join";
            joinbutton.onclick = function(){socket.emit("joinChat", chatname)}*/
            li.appendChild(joinbutton);
            socket.emit("leaveChat", chatname)
          }
          li.appendChild(leavebutton);
          socket.emit("joinChat", chatname)
        }
        li.appendChild(joinbutton);
      })
      
      let twits = document.getElementById("twits")
      socket.on("twits", twit => {
        let div = document.createElement("div");
        div.innerText = twit;
        twits.appendChild(div)
        //console.log(twit)
      })

      socket.on("deleteChat", chatname => {
        let child = document.getElementById(chatname)
        rooms.removeChild(child)
      })
    });
  </script>
</body>

</html>